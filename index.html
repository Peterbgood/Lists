<!DOCTYPE html>
<html lang="en" data-theme="fall">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My To-Do Lists</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ===== Theming & Seasonal Themes ===== */
      :root {
        --bg-color: #f8f9fa;
        --text-color: #212529;
        --card-bg-color: #ffffff;
        --card-shadow: none;
        --hover-bg-color: #f1f3f5;
        --border-color: #dee2e6;
        --muted-text-color: #6c757d;
        --primary-color: #0d6efd;
      }

      [data-theme="spring"] {
        --bg-color: #d8f3dc;
        --text-color: #2f4858;
        --card-bg-color: #f4fff4;
        --hover-bg-color: #c9e9cc;
        --border-color: #9cd6ad;
        --muted-text-color: #6a9c78;
        --primary-color: #40916c;
      }
      
      [data-theme="summer"] {
        --bg-color: #fcf8e3;
        --text-color: #4a4e69;
        --card-bg-color: #ffffff;
        --hover-bg-color: #f0ead2;
        --border-color: #d1b490;
        --muted-text-color: #9a8c98;
        --primary-color: #8c3b0d;
      }
      
      [data-theme="fall"] {
        --bg-color: #d1b490;
        --text-color: #3f2f2f;
        --card-bg-color: #fffaf0;
        --hover-bg-color: #e6e0d9;
        --border-color: #b08d57;
        --muted-text-color: #7b593f;
        --primary-color: #8c3b0d;
      }
      
      [data-theme="winter"] {
        --bg-color: #e0f2f1;
        --text-color: #2c3e50;
        --card-bg-color: #ffffff;
        --hover-bg-color: #cfd8dc;
        --border-color: #90a4ae;
        --muted-text-color: #78909c;
        --primary-color: #546e7a;
      }
      
      html, body {
        transition: background-color 0.3s ease, color 0.3s ease;
        background-color: var(--bg-color);
        color: var(--text-color);
      }

      body {
        font-family: 'Poppins', sans-serif;
        overflow-x: hidden;
      }

      /* ===== General Components ===== */
      .container {
        max-width: 800px;
      }

      .offcanvas {
        background-color: var(--bg-color);
      }
      .form-control, .btn, .offcanvas-header, .input-group-text {
        background-color: var(--card-bg-color);
        color: var(--text-color);
        border-color: var(--border-color);
      }
      .form-control::placeholder {
        color: var(--muted-text-color);
      }
      .form-control:focus {
        background-color: var(--card-bg-color);
        color: var(--text-color);
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(var(--primary-color), 0.25);
      }
      .btn-close {
        filter: var(--text-color) == '#e0e0e0' ? invert(1) : none;
      }
      .list-group-item {
        background-color: transparent;
        border-bottom: 1px solid var(--border-color);
      }

      .list-group-item,
      .list-item,
      .title-container {
        cursor: pointer;
        touch-action: pan-y;
      }
      
      /* New style for edge-to-edge lists */
      .list-unstyled {
          padding-left: 0;
      }
      .list-items .list-item {
          border-radius: 0;
          box-shadow: none;
          padding: 15px 0;
          margin-bottom: 0;
          border-bottom: 1px solid var(--border-color);
          background-color: transparent;
          display: flex;
          align-items: center;
      }
      .list-items .list-item:first-child {
          padding-top: 0;
      }
      .list-items .list-item:last-child {
          border-bottom: none;
      }
      .list-items {
          margin-bottom: 1rem;
      }

      /* ===== Main List Styling ===== */
      #itemsList, #listsMenu {
        position: relative;
        min-height: 150px;
      }
      .item-text {
        flex-grow: 1;
        margin: 0 10px;
        transition: opacity 0.3s ease, text-decoration 0.3s ease;
      }
      .add-item-form {
          display: flex;
          align-items: center;
          gap: 10px;
      }
      .add-item-form .form-control {
          flex-grow: 1;
      }

      .title-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0;
        margin-bottom: 8px;
        border-radius: 8px;
        transition: background-color 0.2s ease-in-out;
      }
      .title-text {
          font-size: 1.5rem;
          margin: 0;
          line-height: 1.2;
      }
      .title-text.text-primary {
          color: var(--primary-color) !important;
      }

      /* ===== Item States (Completed, Adding) ===== */
      @keyframes item-add {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .list-item.new-item {
        animation: item-add 0.4s ease-out;
      }
      .list-item.completed .item-text {
        text-decoration: line-through;
        opacity: 0.6;
      }
      .list-item.swiping {
        transition: none;
      }
      .list-item.deleting {
        transform: translateX(-100%);
        opacity: 0;
      }
      
      /* Reorder button on the right */
      .list-item .reorder-handle {
          order: 1;
          margin-left: auto;
          margin-right: 0;
      }
      .list-item .item-text {
          margin-left: 0;
      }
      .list-item .item-actions {
          order: 0;
          margin-right: 10px;
      }
      .list-item .item-text {
          order: -1;
      }


      /* ===== Empty State Placeholder ===== */
      .empty-list-placeholder {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: var(--muted-text-color);
        pointer-events: none;
      }
      .empty-list-placeholder i {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      /* ===== Action Buttons ===== */
      .list-item .item-actions,
      .title-container .title-actions {
        display: flex;
        gap: 5px;
        visibility: hidden;
      }
      .list-item:hover .item-actions,
      .title-container:hover .title-actions {
        visibility: visible;
      }
      @media (max-width: 768px) {
        .list-item .item-actions {
          display: none;
        }
      }

      /* ===== Seasonal Theme Toggle ===== */
      .theme-switch-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: auto;
        padding: 1rem 0;
        border-top: 1px solid var(--border-color);
      }
      .theme-switch {
        display: inline-block;
        height: 24px;
        position: relative;
        width: 100px;
        margin: 0 10px;
      }
      .theme-switch input {
        display: none;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--border-color);
        transition: .4s;
        border-radius: 34px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: var(--card-bg-color);
        transition: .4s;
        border-radius: 50%;
      }
      .theme-1:checked ~ .slider:before {
          transform: translateX(0px);
      }
      .theme-2:checked ~ .slider:before {
          transform: translateX(25px);
      }
      .theme-3:checked ~ .slider:before {
          transform: translateX(50px);
      }
      .theme-4:checked ~ .slider:before {
          transform: translateX(75px);
      }
      .theme-switch-wrapper i {
        color: var(--muted-text-color);
        font-size: 1.25rem;
        transition: color 0.3s ease;
      }
      .active-season-icon {
        color: var(--primary-color) !important;
      }

      /* ===== Draggable Item Styling ===== */
      .sortable-ghost {
        background-color: var(--hover-bg-color) !important;
        opacity: 0.7;
      }
      .sortable-drag {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div
      class="offcanvas offcanvas-end d-flex flex-column"
      tabindex="-1"
      id="offcanvasLists"
      aria-labelledby="offcanvasListsLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasListsLabel">Your Lists</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body d-flex flex-column">
        <div class="input-group p-3 border-bottom">
          <input
            type="text"
            class="form-control"
            id="newListName"
            placeholder="Add new list..."
          />
          <button class="btn btn-primary" id="addListBtn">
            <i class="fas fa-plus"></i>
          </button>
        </div>
        <ul class="list-group list-group-flush" id="listsMenu"></ul>
        <div class="import-export-buttons d-flex justify-content-center gap-2 mt-auto p-3">
          <button class="btn btn-secondary" id="exportBtn">
            <i class="fas fa-download me-1"></i>Export
          </button>
          <button class="btn btn-secondary" id="importBtn">
            <i class="fas fa-upload me-1"></i>Import
          </button>
          <input
            type="file"
            id="importFile"
            class="d-none"
            accept="application/json"
          />
        </div>
        <div class="theme-switch-wrapper">
          <i class="fas fa-seedling" data-theme-icon="spring"></i>
          <label class="theme-switch">
            <input type="radio" name="theme-radio" id="spring-theme" class="theme-1" value="spring" checked/>
            <input type="radio" name="theme-radio" id="summer-theme" class="theme-2" value="summer"/>
            <input type="radio" name="theme-radio" id="fall-theme" class="theme-3" value="fall"/>
            <input type="radio" name="theme-radio" id="winter-theme" class="theme-4" value="winter"/>
            <div class="slider"></div>
          </label>
          <i class="fas fa-sun" data-theme-icon="summer"></i>
          <i class="fas fa-leaf" data-theme-icon="fall"></i>
          <i class="fas fa-snowflake" data-theme-icon="winter"></i>
        </div>
      </div>
    </div>
    <div class="container py-4">
      <header class="d-flex justify-content-between align-items-center mb-4">
        <div id="currentListHeader"></div>
        <div class="d-flex align-items-center">
            <button
                class="btn btn-outline-primary ms-3"
                type="button"
                data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasLists"
                aria-controls="offcanvasLists"
            >
                <i class="fas fa-bars"></i>
                <span class="d-none d-sm-inline"> Lists</span>
            </button>
        </div>
      </header>
      <main class="p-3" style="background-color: var(--card-bg-color);">
          <ul class="list-items list-unstyled" id="itemsList"></ul>
          <div class="add-item-form mt-3">
            <input
              type="text"
              class="form-control add-item-input"
              placeholder="Add new item..."
            />
            <button class="btn btn-success btn-add-item">
              <i class="fas fa-plus"></i>
            </button>
          </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script>
      let todoData = { lists: [], items: [] };
      let currentListId = null;

      // --- DOM Elements ---
      const docHtml = document.documentElement;
      const listsMenu = document.getElementById("listsMenu");
      const newListNameInput = document.getElementById("newListName");
      const addListBtn = document.getElementById("addListBtn");
      const itemsList = document.getElementById("itemsList");
      const currentListHeader = document.getElementById("currentListHeader");
      const addItemInput = document.querySelector(".add-item-input");
      const addItemBtn = document.querySelector(".btn-add-item");
      const exportBtn = document.getElementById("exportBtn");
      const importBtn = document.getElementById("importBtn");
      const importFile = document.getElementById("importFile");
      const themeRadios = document.querySelectorAll('input[name="theme-radio"]');

      // --- Mobile Gesture State ---
      let touchStartX = 0;
      let touchMoveX = 0;
      let swipedItem = null;
      let isSwiping = false;

      // --- Helper Functions ---
      const isMobile = () => window.innerWidth <= 768;

      // --- Theme Logic ---
      function applyTheme(theme) {
        docHtml.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        
        const activeRadio = document.getElementById(`${theme}-theme`);
        if(activeRadio) activeRadio.checked = true;

        document.querySelectorAll('[data-theme-icon]').forEach(icon => {
            icon.classList.remove('active-season-icon');
        });
        const activeIcon = document.querySelector(`[data-theme-icon="${theme}"]`);
        if (activeIcon) activeIcon.classList.add('active-season-icon');
      }

      function handleThemeChange(e) {
          applyTheme(e.target.value);
      }

      // --- Data Management ---
      function saveData() {
        localStorage.setItem("todoData", JSON.stringify(todoData));
      }

      function loadData() {
        const savedData = localStorage.getItem("todoData");
        if (savedData) todoData = JSON.parse(savedData);
        sortData();
        renderListsMenu();
        if (todoData.lists.length > 0) {
          switchToList(todoData.lists[0].id);
        } else {
          renderItems(null); 
        }
      }

      function sortData() {
        todoData.lists.sort((a, b) => a.position - b.position);
        todoData.items.sort((a, b) => a.position - b.position);
        todoData.items.sort((a, b) => a.completed - b.completed);
      }

      // --- Rendering Functions ---
      function renderListsMenu() {
        listsMenu.innerHTML = "";
        if (todoData.lists.length === 0) {
          listsMenu.innerHTML = `<div class="empty-list-placeholder"><i class="fas fa-folder-plus"></i><p>Create your first list!</p></div>`;
          return;
        }
        todoData.lists.forEach((list) => {
          const listHtml = createListMenuItem(list);
          listsMenu.appendChild(listHtml);
        });
      }

      function createListMenuItem(list) {
        const listItem = document.createElement("li");
        listItem.className = "list-group-item d-flex justify-content-between align-items-center";
        listItem.setAttribute("data-list-id", list.id);
        listItem.innerHTML = `<span class="list-name">${list.name}</span>`;
        listItem.addEventListener("click", () => switchToList(list.id));
        return listItem;
      }

      function switchToList(listId) {
        currentListId = listId;
        const list = todoData.lists.find((l) => l.id === listId);
        if (list) {
          currentListHeader.innerHTML = `
            <div class="title-container" data-list-id="${list.id}">
              <h1 class="title-text text-primary">${list.name}</h1>
              <div class="title-actions">
                <button class="btn btn-sm btn-info edit-title-btn" title="Edit Title"><i class="fas fa-pencil-alt"></i></button>
                <button class="btn btn-sm btn-danger delete-title-btn" title="Delete List"><i class="fas fa-trash"></i></button>
              </div>
            </div>`;
          renderItems(listId);
        }
        const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById("offcanvasLists"));
        if (offcanvas) offcanvas.hide();
      }

      function renderItems(listId) {
        itemsList.innerHTML = "";
        const listItems = todoData.items.filter((item) => item.list_id === listId);
        
        if (listId === null || todoData.lists.length === 0) {
            itemsList.innerHTML = `<div class="empty-list-placeholder"><i class="fas fa-list-check"></i><p>Create or select a list to begin.</p></div>`;
            return;
        }

        if (listItems.length === 0) {
            itemsList.innerHTML = `<div class="empty-list-placeholder"><i class="fas fa-plus-circle"></i><p>Add an item to get started!</p></div>`;
            return;
        }

        listItems.forEach((item) => {
          const itemHtml = createItemHtml(item);
          itemsList.appendChild(itemHtml);
        });
      }

      function createItemHtml(item) {
        const listItem = document.createElement("li");
        const isCompleted = item.completed ? 'completed' : '';
        listItem.className = `list-item ${isCompleted}`;
        listItem.setAttribute("data-item-id", item.id);
        
        listItem.innerHTML = `
          <span class="item-text">${item.text}</span>
          <div class="item-actions">
            <button class="btn btn-sm btn-info edit-item-btn" title="Edit Item"><i class="fas fa-pencil-alt"></i></button>
            <button class="btn btn-sm btn-danger delete-item-btn" title="Delete Item"><i class="fas fa-trash"></i></button>
          </div>
          <i class="fas fa-grip-vertical reorder-handle ms-2 text-muted"></i>`;
        return listItem;
      }
      
      // --- Event Handlers ---
      function addEventListeners() {
        addListBtn.addEventListener("click", handleAddList);
        newListNameInput.addEventListener("keypress", (e) => e.key === "Enter" && handleAddList());

        addItemBtn.addEventListener("click", handleAddItem);
        addItemInput.addEventListener("keypress", (e) => e.key === "Enter" && handleAddItem());

        document.addEventListener("click", handleDocumentClick);
        itemsList.addEventListener('change', handleItemCheckboxChange);

        itemsList.addEventListener('touchstart', handleTouchStart, { passive: true });
        itemsList.addEventListener('touchmove', handleTouchMove, { passive: true });
        itemsList.addEventListener('touchend', handleTouchEnd);
        
        themeRadios.forEach(radio => radio.addEventListener('change', handleThemeChange));

        exportBtn.addEventListener("click", exportData);
        importBtn.addEventListener("click", () => importFile.click());
        importFile.addEventListener("change", importData);
      }
      
      function handleAddList() {
        const name = newListNameInput.value.trim();
        if (name) {
          addList(name);
          newListNameInput.value = "";
        }
      }

      function handleAddItem() {
        const text = addItemInput.value.trim();
        if (text && currentListId !== null) {
          addItem(currentListId, text);
          addItemInput.value = "";
          addItemInput.focus();
        }
      }
      
      function handleDocumentClick(e) {
          if (e.target.closest(".edit-title-btn")) toggleInLineEdit("list", currentListId);
          if (e.target.closest(".delete-title-btn")) deleteList(currentListId);

          const listItem = e.target.closest('.list-item');
          if (!listItem) return;

          const itemId = parseInt(listItem.dataset.itemId);
          if (isMobile()) {
              if (!isSwiping && e.target.closest('.item-text')) toggleInLineEdit("item", itemId);
          } else {
              if (e.target.closest(".edit-item-btn")) toggleInLineEdit("item", itemId);
              if (e.target.closest(".delete-item-btn")) deleteItemWithAnimation(itemId);
          }
      }

      function handleItemCheckboxChange(e) {
          if (e.target.matches('.item-checkbox')) {
              const listItem = e.target.closest('.list-item');
              const itemId = parseInt(listItem.dataset.itemId);
              const item = todoData.items.find(i => i.id === itemId);
              if (item) {
                  item.completed = e.target.checked;
                  listItem.classList.toggle('completed', item.completed);
                  sortData();
                  saveData();
                  setTimeout(() => renderItems(currentListId), 300);
              }
          }
      }

      function handleTouchStart(e) {
          if (!isMobile()) return;
          const targetItem = e.target.closest('.list-item');
          if (targetItem) {
              swipedItem = targetItem;
              touchStartX = e.touches[0].clientX;
              touchMoveX = touchStartX;
              isSwiping = false;
              swipedItem.classList.add('swiping');
          }
      }

      function handleTouchMove(e) {
          if (!isMobile() || !swipedItem) return;
          touchMoveX = e.touches[0].clientX;
          const diffX = touchMoveX - touchStartX;
          if (Math.abs(diffX) > 15) isSwiping = true;
          if (diffX < 0) swipedItem.style.transform = `translateX(${diffX}px)`;
      }

      function handleTouchEnd() {
          if (!isMobile() || !swipedItem) return;
          swipedItem.classList.remove('swiping');
          const diffX = touchMoveX - touchStartX;
          const deleteThreshold = swipedItem.offsetWidth / 3;
          if (diffX < -deleteThreshold) {
              deleteItemWithAnimation(parseInt(swipedItem.dataset.itemId));
          } else {
              swipedItem.style.transform = '';
          }
          setTimeout(() => { isSwiping = false; }, 200);
          swipedItem = null;
      }
      
      // --- CRUD & Other Operations ---
      function addItem(listId, text) {
        const newId = todoData.items.length > 0 ? Math.max(...todoData.items.map((i) => i.id), 0) + 1 : 1;
        const newPosition = todoData.items.filter(i => i.list_id === listId).length + 1;
        todoData.items.push({
          id: newId, list_id: listId, text, position: newPosition, completed: false
        });
        sortData();
        renderItems(listId);
        const newItemEl = itemsList.querySelector(`[data-item-id="${newId}"]`);
        if (newItemEl) {
            newItemEl.classList.add('new-item');
        }
        saveData();
      }

      function deleteItemWithAnimation(id) {
          const itemElement = document.querySelector(`.list-item[data-item-id="${id}"]`);
          if (itemElement) {
              itemElement.classList.add('deleting');
              itemElement.addEventListener('transitionend', () => deleteItem(id), { once: true });
          } else {
              deleteItem(id);
          }
      }

      function deleteItem(id) {
        todoData.items = todoData.items.filter((item) => item.id !== id);
        renderItems(currentListId);
        saveData();
      }
      
      function editItem(id, newText) {
        const item = todoData.items.find((i) => i.id === id);
        if (item) {
          item.text = newText;
          saveData();
        }
      }

      // --- Initialization ---
      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem('theme') || 'fall';
        applyTheme(savedTheme);
        loadData();
        addEventListeners();
        initializeSortable();
      });

      function initializeSortable() {
        new Sortable(listsMenu, { animation: 150, ghostClass: "sortable-ghost", onEnd: updateListPositions });
        new Sortable(itemsList, { animation: 150, ghostClass: "sortable-ghost", handle: '.reorder-handle', onEnd: updateItemPositions });
      }
      function updateListPositions() {
        Array.from(listsMenu.querySelectorAll(".list-group-item")).forEach((el, index) => {
          const list = todoData.lists.find(l => l.id === parseInt(el.dataset.listId));
          if(list) list.position = index;
        });
        sortData(); saveData();
      }
      function updateItemPositions() {
        Array.from(itemsList.querySelectorAll(".list-item")).forEach((el, index) => {
          const item = todoData.items.find(i => i.id === parseInt(el.dataset.itemId));
          if(item) item.position = index;
        });
        sortData(); saveData();
      }
      function toggleInLineEdit(type, id) {
        if (type === "list") {
            const container = document.querySelector(`.title-container[data-list-id="${id}"]`);
            const textEl = container.querySelector(".title-text");
            const originalText = todoData.lists.find(l => l.id === id).name;
            const input = document.createElement("input");
            input.type = "text"; input.value = originalText; input.className = "form-control";
            textEl.innerHTML = ""; textEl.appendChild(input); input.focus();
            const save = () => (input.value.trim() && input.value.trim() !== originalText) ? editList(id, input.value.trim()) : switchToList(id);
            input.addEventListener("blur", save);
            input.addEventListener("keypress", (e) => e.key === "Enter" && save());
        } else if (type === "item") {
            const itemElement = document.querySelector(`.list-item[data-item-id="${id}"]`);
            const span = itemElement.querySelector(".item-text");
            const originalText = todoData.items.find(i => i.id === id).text;
            const input = document.createElement("input");
            input.type = "text"; input.value = originalText; input.className = "form-control form-control-sm";
            span.innerHTML = ""; span.appendChild(input); input.focus();
            const save = () => {
                const newText = input.value.trim();
                if (newText && newText !== originalText) editItem(id, newText);
                span.innerHTML = newText || originalText;
            };
            input.addEventListener("blur", save);
            input.addEventListener("keypress", (e) => e.key === "Enter" && save());
        }
      }
      function addList(name) {
        const newId = todoData.lists.length > 0 ? Math.max(...todoData.lists.map(l => l.id)) + 1 : 1;
        todoData.lists.push({ id: newId, name, position: todoData.lists.length });
        sortData(); renderListsMenu(); saveData(); switchToList(newId);
      }
      function deleteList(id) {
        if (confirm("Delete this list and all its items?")) {
          todoData.lists = todoData.lists.filter(l => l.id !== id);
          todoData.items = todoData.items.filter(i => i.list_id !== id);
          saveData(); renderListsMenu();
          if (currentListId === id) {
            if (todoData.lists.length > 0) switchToList(todoData.lists[0].id);
            else { currentListHeader.innerHTML = ""; renderItems(null); }
          }
        }
      }
      function editList(id, newName) {
        const list = todoData.lists.find(l => l.id === id);
        if (list) { list.name = newName; saveData(); renderListsMenu(); if (currentListId === id) switchToList(id); }
      }
      function exportData() {
        const dataStr = JSON.stringify(todoData, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "todo_data.json"; a.click(); URL.revokeObjectURL(a.href);
      }
      function importData(e) {
        const file = e.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = JSON.parse(event.target.result);
            if (data.lists && data.items) {
              todoData = data; sortData(); saveData();
              renderListsMenu();
              if (todoData.lists.length > 0) switchToList(todoData.lists[0].id);
              else { currentListHeader.innerHTML = ""; renderItems(null); }
              alert("Data imported!");
            } else alert("Invalid file format.");
          } catch (error) { alert("Failed to parse file."); }
        };
        reader.readAsText(file);
      }
    </script>
  </body>
</html>
